/*
 * angular-click-x v1.1.2
 * (c) 2016 Tanase Butcaru, http://www.butcaru.com
 * License: MIT
 * 
 * GitHub: https://github.com/TanaseButcaru/angular-click-x
 */

"use strict";"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="tb.clickX"),angular.module("tb.clickX",[]).provider("clickXConfig",function(){function e(){var e=!1,t={apple_phone:/iPhone/i,apple_ipod:/iPod/i,apple_tablet:/iPad/i,android_phone:/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,android_tablet:/Android/i,amazon_phone:/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,amazon_tablet:/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,windows_phone:/IEMobile/i,windows_tablet:/(?=.*\bWindows\b)(?=.*\bARM\b)/i,other_blackberry:/BlackBerry/i,other_blackberry_10:/BB10/i,other_opera:/Opera Mini/i,other_chrome:/(CriOS|Chrome)(?=.*\bMobile\b)/i,other_firefox:/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i};return angular.forEach(t,function(t,i){return e?!1:void(e=t.test(navigator.userAgent))}),e}window.clickX={},this.isMobile=e(),this.activeClass="click-x-active",this.swipeConfig={threshold:50,restraint:50,allowedTime:400},this.setActiveClass=function(e){angular.isString(e)&&(this.activeClass=e)},this.setSwipeConfig=function(e){angular.isObject(e)&&angular.forEach(e,function(e,t){this.swipeConfig.hasOwnProperty(t)&&angular.isNumber(e)&&(this.swipeConfig[t]=e)},this)},this.$get=function(){return this}}).directive("clickX",["$parse","$window","clickXConfig",function(e,t,i){return{priority:0,restrict:"A",link:function(n,r,o){function a(e){if(i.isMobile)p(e);else if(t.clickX.hasOwnProperty("startTarget")){if(!v(e))return!1}else p(e);k()?w():X.classList.add(i.activeClass)}function c(e){p(e,"end"),X.classList.remove(i.activeClass),b().active||k()||!v()||n.$apply(function(){m(n,{$event:e})}),w()}function s(e){X.classList.remove(i.activeClass)}function l(e){t.clickX.hasOwnProperty("startTarget")&&(v(e)||w())}function u(e){t.clickX.hasOwnProperty("startTarget")&&a(e)}function d(e){t.clickX.hasOwnProperty("startTarget")&&s(e)}function h(e){e.preventDefault(),e.stopPropagation()}function p(e,n){var r,o,a,c,s,l,u;i.isMobile?(r=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY,a=e.changedTouches[0].pageX,c=e.changedTouches[0].pageY):(r=e.clientX,o=e.clientY,a=e.pageX,c=e.pageY),"end"==n?(s="endTarget",l="endPosition",u="endSwipe"):(s="startTarget",l="startPosition",u="startSwipe"),t.clickX[s]=g(r,o),t.clickX[s]===!1?w():(t.clickX[l]=f(t.clickX[s]),t.clickX[u]={x:a,y:c,time:(new Date).getTime()})}function g(e,t){var i=!1,n=document.elementFromPoint(e,t);if(null!==n&&angular.isFunction(n.hasAttribute))if(n.hasAttribute("click-x")===!0)i=n;else{for(i=n.parentNode;null!==i&&angular.isFunction(i.hasAttribute)&&i.hasAttribute("click-x")===!1;)i=i.parentNode;null!==i&&angular.isFunction(i.hasAttribute)||(i=!1)}else i=!1;return i}function f(e){return{top:e.getBoundingClientRect().top,left:e.getBoundingClientRect().left,right:e.getBoundingClientRect().right}}function v(e){var n,r,o,a,c=!1;if(angular.isDefined(e)){if(i.isMobile)var s=e.changedTouches[0].clientX,l=e.changedTouches[0].clientY;else var s=e.clientX,l=e.clientY;if(r=g(s,l),r===!1)return!1;a=f(r)}else{if(!t.clickX.hasOwnProperty("endTarget"))return!1;r=t.clickX.endTarget,a=t.clickX.endPosition}return t.clickX.hasOwnProperty("startTarget")?(n=t.clickX.startTarget,o=t.clickX.startPosition,c=n.isEqualNode(r),c&&!angular.equals(o,a)&&(c=!1),c):!1}function b(){var e,n,r,o={active:!1,dir:"none"};return t.clickX.hasOwnProperty("endTarget")&&t.clickX.hasOwnProperty("startTarget")?(e=t.clickX.endSwipe.x-t.clickX.startSwipe.x,n=t.clickX.endSwipe.y-t.clickX.startSwipe.y,r=t.clickX.endSwipe.time-t.clickX.startSwipe.time,r<=i.swipeConfig.allowedTime&&(Math.abs(e)>=i.swipeConfig.threshold&&Math.abs(n)<=i.swipeConfig.restraint?(o.dir=0>e?"left":"right",o.active=!0):Math.abs(n)>=i.swipeConfig.threshold&&Math.abs(e)<=i.swipeConfig.restraint&&(o.dir=0>n?"up":"down",o.active=!0)),o):o}function k(){var e=!1;return e=t.clickX.hasOwnProperty("endTarget")?t.clickX.endTarget.getAttribute("disabled"):t.clickX.hasOwnProperty("startTarget")?t.clickX.startTarget.getAttribute("disabled"):!1}function w(){for(var e in t.clickX)delete t.clickX[e]}var X=r[0],m=e(o.clickX);i.isMobile?(X.addEventListener("touchstart",a),X.addEventListener("touchend",c),X.addEventListener("touchcancel",s)):(X.addEventListener("mousedown",a),X.addEventListener("mouseup",c),t.addEventListener("mouseup",l),X.addEventListener("mouseenter",u),X.addEventListener("mouseleave",d)),X.addEventListener("click",h),n.$on("$destroy",function(){i.isMobile?(X.removeEventListener("touchstart",a),X.removeEventListener("touchend",c),X.removeEventListener("touchcancel",s)):(X.removeEventListener("mousedown",a),X.removeEventListener("mouseup",c),t.removeEventListener("mouseup",l),X.removeEventListener("mouseenter",u),X.removeEventListener("mouseleave",d)),X.removeEventListener("click",h),w()})}}}]);
